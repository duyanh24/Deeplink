<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Open App</title>
    <script>
        let interacted = false;

        document.addEventListener("click", () => interacted = true);
        document.addEventListener("touchstart", () => interacted = true);

        function openApp() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get("id") ?? "";

            const appURL = "mangaapp://manga?id=" + id;
            const appStoreURL = "https://apps.apple.com/vn/app/manga-reader-king/id6739520174";

            // Try opening via iframe first (avoid popup in some browsers)
            const iframe = document.createElement("iframe");
            iframe.style.display = "none";
            iframe.src = appURL;
            document.body.appendChild(iframe);

            const start = Date.now();

            // Fallback logic
            setTimeout(() => {
                if (interacted) return; // user bấm "Open"

                if (Date.now() - start < 3500) {
                    window.location = appStoreURL;
                }
            }, 3500);
        }
    </script>
</head>
<body onload="openApp()">
    <h3>Đang mở ứng dụng…</h3>
</body>
</html>

